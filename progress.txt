# Progress Log
Run: 00b4d2cc-3301-4400-87a3-13ca6d768cbd
Task: Rebuild Comal County GOP Watch into multi-page political intelligence hub
Started: 2026-02-11

## Codebase Patterns
- layout.js uses IIFE pattern; exports via module.exports for Node, auto-inits in browser via DOMContentLoaded
- Pages include `<div id="site-nav"></div>` and `<div id="site-footer"></div>` + `<script src="/js/layout.js"></script>`
- Feed JSON files use ID prefixes: cn- (candidate), pf- (policy), bw- (business)
- officials.json has slugs for URL-safe linking to bio pages
- Data files live in data/ directory, validated by test/validate-json.test.js
- Previous patterns:
- Static site, GitHub Pages — no build tools, vanilla HTML/CSS/JS only
- Fonts: Playfair Display (headings) + Source Sans 3 (body) via Google Fonts
- Color scheme: --red (#8B1A1A), --navy (#1B2A4A), --cream (#FDF8F0), --gold (#C5993A)
- Tests use `node --test test/*.test.js` (Node.js built-in test runner)
- JS uses CommonJS `module.exports` for Node compatibility + browser globals
- Shared styles in css/shared.css, utilities in js/utils.js
- JSON validation via test/validate-json.js (schema: 'feed-entry')
- Date strings should use T12:00:00 suffix to avoid timezone day-shift issues in tests
- Feed pages pattern: page-header (navy gradient) → breadcrumb → filter-bar → feed-container; filter via event delegation; fetch JSON with fetchFeed(), render with renderFeedList()

---

## 2026-02-11 13:17 - US-001: Add project scaffolding, shared CSS, and test infrastructure
- Created package.json with test script
- Extracted shared CSS (variables, nav, footer, cards-grid, responsive breakpoints) into css/shared.css
- Created js/utils.js with formatDate, truncateText, slugify
- Created test/utils.test.js (9 tests) and test/validate-json.test.js (6 tests) + test/validate-json.js
- All 20 tests pass
- **Learnings:** Date-only ISO strings (YYYY-MM-DD) parse as UTC midnight, can shift day in local TZ tests
---

## 2026-02-11 13:22 - US-002: Create JSON data files with schema and seed data
- Created 3 feed JSON files (candidate-news, policy-feed, business-watch) with 3 seed entries each
- Extracted all officials/candidates from index.html into data/officials.json with slug fields
- Documented full schema, categories taxonomy, and tags in data/schema.md
- Added 9 new validation tests (feed files + officials structure)
- All 29 tests passing
- Files changed: data/*.json, data/schema.md, test/validate-json.test.js
- **Learnings:** officials.json includes election_calendar too; slugs added for future bio page linking
---

## 2026-02-11 13:27 - US-003: Build feed renderer JS module
- Created js/feed-renderer.js with fetchFeed, renderFeedCard, renderFeedList, renderFeedPreview
- All functions sort entries newest-first; render functions return HTML and optionally set container.innerHTML
- renderFeedPreview accepts limit param (default 3) and viewAllUrl for "View All" link
- Includes escapeHtml for XSS prevention, formatCategory for slug-to-label conversion
- Created test/feed-renderer.test.js with 18 tests across 6 suites
- All 47 tests pass (18 new + 29 existing)
- Files changed: js/feed-renderer.js, test/feed-renderer.test.js
- **Learnings:** feed-renderer uses inline formatDate fallback when utils.js isn't loaded (Node test env)
---

## 2026-02-11 13:33 - US-004: Create shared HTML layout components (nav and footer partials)
- Created js/layout.js with renderNav, renderFooter, initMobileMenu, initLayout
- Nav links: Home (/), Candidates (/feeds/candidates.html), Policy (/feeds/policy.html), Business Watch (/feeds/business.html)
- Mobile hamburger menu toggles .open class on nav-links
- Footer includes branding, copyright year, last-updated date
- Auto-injects into #site-nav and #site-footer on DOMContentLoaded
- Created test/layout.test.js with 13 tests (nav links, footer content, NAV_LINKS export)
- Created test/layout-test.html for visual browser testing
- All 60 tests pass (13 new + 47 existing)
- Files changed: js/layout.js, test/layout.test.js, test/layout-test.html
- **Learnings:** IIFE pattern works well for browser global + Node CJS dual export
---

## 2026-02-11 13:50 - US-005: Redesign homepage with three feed preview sections
- Rewrote index.html: removed 300+ lines of inline CSS, linked css/shared.css
- Added site-nav/site-footer placeholders for layout.js injection
- Three feed preview sections: Candidate News, Public Policy, Business Watch
- Each section uses fetchFeed + renderFeedPreview (3 entries, View All link)
- Officials grid now reads from data/officials.json (uses slug for profile links)
- Election calendar and alert banner render from officials.json data
- Loads js/utils.js, js/feed-renderer.js, js/layout.js
- Page-specific styles (hero, calendar, officials, alert) remain inline
- Created test/homepage.test.js with 26 tests covering all acceptance criteria
- All 86 tests pass (26 new + 60 existing)
- Files changed: index.html, test/homepage.test.js
- **Learnings:** Keep page-specific styles inline but move shared styles to shared.css; officials.json slug field makes profile linking clean
---

## 2026-02-11 14:52 - US-006: Create candidate news feed page
- Created feeds/candidates.html with full candidate/official news feed
- Page header with navy gradient, breadcrumb back to home
- Dynamic category filter buttons extracted from data (All + unique categories)
- Client-side filtering via event delegation on filter bar
- Fetches data/candidate-news.json, renders via renderFeedList sorted newest-first
- Created test/candidates-feed.test.js with 22 tests (page structure, filtering logic, responsiveness)
- All 108 tests pass (22 new + 86 existing)
- Files changed: feeds/candidates.html, test/candidates-feed.test.js
- **Learnings:** Feed page pattern: page-header div, breadcrumb, filter-bar, feed-container; reuse this for policy and business feed pages
---

## 2026-02-11 15:39 - US-007: Create policy feed page
- Created feeds/policy.html following same pattern as candidates feed page
- Page header: "Public Policy & Local Government" with navy gradient
- Fetches data/policy-feed.json, renders via renderFeedList newest-first
- Dynamic category filter buttons with event delegation
- Shared nav/footer via layout.js
- Created test/policy-feed.test.js with 22 tests (page structure, filtering logic, responsiveness)
- All 130 tests pass (22 new + 108 existing)
- Files changed: feeds/policy.html, test/policy-feed.test.js
- **Learnings:** Feed page pattern is fully reusable — just change title, description, and JSON path
---

## 2026-02-11 15:47 - US-008: Create business watch feed page
- Created feeds/business.html following established feed page pattern
- Page header: "Business Watch" with navy gradient
- Fetches data/business-watch.json, renders via renderFeedList newest-first
- Dynamic category filter buttons with event delegation
- Shared nav/footer via layout.js
- Created test/business-feed.test.js with 22 tests (page structure, filtering logic, responsiveness)
- All 152 tests pass (22 new + 130 existing)
- Files changed: feeds/business.html, test/business-feed.test.js
- **Learnings:** Pattern fully confirmed — all three feed pages are structurally identical
---

## 2026-02-11 15:52 - US-009: Update profile pages to use shared layout and show candidate news feed
- Created js/profile-feed.js with getCandidateSlug, filterByCandidate, renderProfileFeed, initProfileFeed
- Updated all 18 profile pages: removed inline nav/footer, linked shared.css, added layout.js, added Recent Activity section
- Each profile page has data-candidate-slug attribute on <body> for feed filtering
- Profile pages detect slug from data attribute or URL pathname
- Created test/profile-feed.test.js with 142 tests (slug detection, filtering, rendering, all 18 pages structure)
- All 294 tests pass (142 new + 152 existing)
- Files changed: js/profile-feed.js, test/profile-feed.test.js, all 18 profiles/*.html
- **Learnings:** Python script approach works well for bulk-updating similar HTML files; data attributes on <body> are cleaner than parsing title text
---
